import sys
import time
import struct
import statistics

from task.helper import get_data
from util.util import TcpClient, timestamp
import pickle
import os


def main():

    #using Exodia2
    list_bertBase = [600, 600, 
    #Values from 5x10 runs x6 requests each
    272.8419303894043, 273.3771800994873, 272.8574275970459, 275.7105827331543, 272.45187759399414, 273.18811416625977, 272.1295356750488, 272.8891372680664, 272.676944732666, 272.7999687194824
    , 273.55360984802246, 274.17874336242676, 274.14941787719727, 273.58055114746094, 272.16410636901855, 273.303747177124, 273.2970714569092, 273.4029293060303, 272.6747989654541, 273.2524871826172
    , 273.3118534088135, 272.82094955444336, 273.76270294189453, 272.6266384124756, 274.1267681121826, 272.02773094177246, 273.1032371520996, 272.66454696655273, 272.91154861450195, 272.5861072540283
    , 274.0349769592285, 273.5445499420166, 273.83899688720703, 273.90027046203613, 273.8528251647949, 275.76255798339844, 278.40280532836914, 273.46086502075195, 277.3454189300537, 272.9358673095703
    ,274.4336128234863, 273.44393730163574, 272.7956771850586, 275.2096652984619, 273.11086654663086, 273.78058433532715, 273.6356258392334, 273.1940746307373, 273.1800079345703, 273.12231063842773
    ]

    list_Resnet = [600,600
    , 408.282995223999, 398.9229202270508, 397.6635932922363, 393.09167861938477, 387.3894214630127, 397.1283435821533, 405.34257888793945, 395.58982849121094, 392.7454948425293, 392.017126083374
    , 411.90361976623535, 403.1076431274414, 407.98187255859375, 397.8121280670166, 396.82888984680176, 397.77350425720215, 404.9689769744873, 403.3622741699219, 398.6055850982666, 400.7852077484131
    , 398.47874641418457, 403.4247398376465, 420.23706436157227, 401.59106254577637, 418.75243186950684, 392.9553031921387, 408.0352783203125, 401.03602409362793, 406.16536140441895, 397.79210090637207
    , 424.0298271179199, 394.8845863342285, 407.14406967163086, 391.62230491638184, 394.03414726257324, 399.43552017211914, 400.30956268310547, 390.028715133667, 405.80201148986816, 391.6172981262207
    , 407.55224227905273, 390.2139663696289, 398.8533020019531, 392.79842376708984, 398.146390914917, 390.6872272491455, 387.94851303100586, 397.8309631347656, 399.3351459503174, 397.7944850921631
    ]
    list_inception = [ 600, 600
    , 331.8817615509033, 312.6790523529053, 330.2266597747803, 313.85254859924316, 303.0574321746826, 309.31878089904785, 314.03040885925293, 307.1613311767578, 317.14510917663574, 315.53173065185547
    , 346.70567512512207, 318.39847564697266, 345.31188011169434, 312.4120235443115, 317.6300525665283, 313.1091594696045, 311.90967559814453, 312.9432201385498, 317.0444965362549, 328.16243171691895
    , 316.2844181060791, 323.5750198364258, 321.92134857177734, 311.2916946411133, 307.30581283569336, 315.91010093688965, 331.4542770385742, 307.178258895874, 316.8618679046631, 307.830810546875
    , 318.6826705932617, 334.6741199493408, 307.50036239624023, 313.5535717010498, 306.28466606140137, 322.0992088317871, 310.8499050140381, 312.79802322387695, 324.4340419769287, 309.722900390625
    , 354.62284088134766, 316.3599967956543, 347.52511978149414, 317.547082901001, 320.3754425048828, 313.8546943664551, 324.17988777160645, 313.3211135864258, 310.57238578796387, 313.47131729125977   
    ]



    awgBB = Average(list_bertBase)
    awgRN = Average(list_Resnet)
    awgI3 = Average(list_inception)

    perR_BB = awgBB/6
    perR_RN = awgRN/6
    perR_I3 = awgI3/6
    print('(Request aware PipeSwitch) Average time for BB is : ' + str(awgBB) +' with a perRun of: ' + str(perR_BB))
    print('Request aware PipeSwitch) Average time for RN is : ' + str(awgRN) +' with a perRun of: ' + str(perR_RN))
    print('Request aware PipeSwitch) Average time for I3 is : ' + str(awgI3) +' with a perRun of: ' + str(perR_I3))

    #Using NewWorker
    list_bertBase_ps =[671.208381652832, 332.9291343688965, 332.7045440673828, 333.7075710296631, 333.7242603302002, 334.9635601043701, 334.11288261413574, 333.52208137512207, 333.61101150512695, 335.6022834777832, 334.11359786987305, 334.6869945526123, 337.47172355651855, 336.0929489135742, 336.1384868621826, 335.30139923095703, 340.90518951416016, 335.22558212280273, 335.3002071380615, 335.86835861206055, 339.25533294677734, 336.0905647277832, 338.8097286224365, 335.7698917388916, 335.7577323913574, 335.66808700561523, 335.02912521362305, 337.22901344299316, 333.8637351989746, 334.1064453125, 334.34081077575684, 333.96244049072266, 336.7798328399658, 332.81683921813965, 333.85586738586426, 335.3581428527832, 335.31808853149414, 335.95824241638184, 336.40217781066895, 332.0019245147705, 332.52906799316406, 332.36193656921387, 332.3173522949219, 334.2881202697754, 332.8824043273926, 333.13918113708496, 332.3342800140381, 332.2179317474365, 332.86428451538086, 332.96680450439453]
    list_resnet_ps = [552.3386001586914, 464.32042121887207, 482.35368728637695, 456.18200302124023, 453.4945487976074, 453.7985324859619, 454.87236976623535, 454.14161682128906, 445.9824562072754, 448.760986328125, 446.03514671325684, 440.4644966125488, 448.589563369751, 462.2783660888672, 454.15520668029785, 448.91357421875, 448.44627380371094, 448.5805034637451, 464.0772342681885, 461.101770401001, 457.81493186950684, 457.25083351135254, 449.7082233428955, 451.57456398010254, 464.82110023498535, 469.65575218200684, 456.7422866821289, 459.90991592407227, 455.9593200683594, 457.63659477233887, 451.4741897583008, 454.6639919281006, 453.11975479125977, 453.95421981811523, 451.85256004333496, 451.9503116607666, 451.88236236572266, 458.07647705078125, 460.61134338378906, 465.92116355895996, 464.57552909851074, 454.39743995666504, 462.4326229095459, 463.75060081481934, 479.02512550354004, 452.52466201782227, 452.50535011291504, 455.6436538696289, 452.9120922088623, 454.78034019470215]
    list_inception_ps = [402.493953704834, 381.12616539001465, 375.7641315460205, 378.2517910003662, 391.94297790527344, 386.90829277038574, 385.7874870300293, 381.32500648498535, 393.53036880493164, 378.10635566711426, 380.3706169128418, 384.14645195007324, 380.74421882629395, 387.80784606933594, 387.76302337646484, 380.9518814086914, 377.6700496673584, 388.8838291168213, 380.15198707580566, 377.122163772583, 384.7966194152832, 388.4015083312988, 400.6335735321045, 385.47658920288086, 390.49530029296875, 369.3656921386719, 372.62940406799316, 381.056547164917, 377.8676986694336, 365.68522453308105, 382.51233100891113, 368.757963180542, 373.71087074279785, 371.86622619628906, 373.884916305542, 368.1912422180176, 377.2470951080322, 378.262996673584, 378.05938720703125, 394.0098285675049, 389.8491859436035, 399.8243808746338, 420.92061042785645, 391.01552963256836, 379.08482551574707, 387.58087158203125, 380.89680671691895, 389.8742198944092, 376.16944313049316, 374.2823600769043]

    
    awgBB_ps = Average(list_bertBase_ps)
    awgRN_ps = Average(list_resnet_ps)
    awgI3_ps = Average(list_inception_ps)
  

    perR_BB_ps = awgBB_ps/6
    perR_RN_ps = awgRN_ps/6
    perR_I3_ps = awgI3_ps/6
    
    print('(PipeSwitch) Average time for BB is : ' + str(awgBB_ps) +' with a perRun of: ' + str(perR_BB_ps))
    print('(PipeSwitch) Average time for RN is : ' + str(awgRN_ps) +' with a perRun of: ' + str(perR_RN_ps))
    print('(PipeSwitch) Average time for I3 is : ' + str(awgI3_ps) +' with a perRun of: ' + str(perR_I3_ps))



    print("-------------------------------------------------")
    print("Complex sequences 50 runs each (multiple requests in each run): ")
    #bert_base;bert_base;bert_base;bert_base;inception_v3;resnet152;resnet152;resnet152;resnet152;resnet152;resnext101_32x8d;resnext101_32x8d
    #12 requests total
    Complex1 = [1593.6133861541748, 1110.0578308105469, 1094.5358276367188, 1106.58860206604, 1093.0588245391846, 1118.8020706176758, 1096.073865890503, 1074.2545127868652, 1083.885908126831, 1062.180995941162, 1081.2010765075684, 1078.545331954956, 1072.73530960083, 1062.0603561401367, 1075.347661972046, 1075.4215717315674, 1066.889762878418, 1060.7233047485352, 1066.8301582336426, 1063.082218170166, 1064.096212387085, 1068.1326389312744, 1049.9398708343506, 1058.3930015563965, 1056.0436248779297, 1062.2808933258057, 1074.5394229888916, 1068.406105041504, 1061.220407485962, 1061.8090629577637, 1059.278964996338, 1059.5266819000244, 1060.018539428711, 1070.969820022583, 1078.4566402435303, 1064.41330909729, 1060.1513385772705, 1060.3327751159668, 1059.3538284301758, 1064.4068717956543, 1058.5741996765137, 1070.7712173461914, 1067.814826965332, 1074.1899013519287, 1060.654640197754, 1075.0384330749512, 1058.2447052001953, 1056.8451881408691, 1055.8538436889648, 1060.0154399871826]
    
    Complex2 = [1168.379783630371, 661.121129989624, 677.9458522796631, 656.475305557251, 680.5388927459717, 658.6616039276123, 659.0001583099365, 659.8625183105469, 656.1570167541504, 671.6067790985107, 673.2852458953857, 667.9766178131104, 662.8804206848145, 662.2028350830078, 668.4911251068115, 660.1300239562988, 662.2536182403564, 651.8270969390869, 662.4047756195068, 658.8108539581299, 661.5946292877197, 664.2217636108398, 680.5558204650879, 666.8620109558105, 668.8363552093506, 661.2777709960938, 662.1637344360352, 658.571720123291, 665.7445430755615, 658.4174633026123, 675.2157211303711, 667.7124500274658, 685.4259967803955, 669.5303916931152, 662.7118587493896, 656.9883823394775, 666.1393642425537, 664.9978160858154, 660.5160236358643, 659.6651077270508, 678.0273914337158, 664.8268699645996, 661.552906036377, 666.8601036071777, 662.3344421386719, 659.6112251281738, 660.102128982544, 658.4076881408691, 665.4179096221924, 657.2983264923096]
    
    Complex3 = [1522.7844715118408, 1288.26904296875, 1273.8208770751953, 1262.275218963623, 1292.4635410308838, 1276.1006355285645, 1328.1235694885254, 1299.870491027832, 1271.4505195617676, 1320.2271461486816, 1271.2585926055908, 1288.9409065246582, 1280.2670001983643, 1285.149335861206, 1280.3809642791748, 1283.7586402893066, 1272.4084854125977, 1267.4689292907715, 1270.6801891326904, 1261.3627910614014, 1260.4718208312988, 1266.6382789611816, 1274.7704982757568, 1261.225938796997, 1270.8930969238281, 1270.364761352539, 1259.268045425415, 1272.0155715942383, 1265.821933746338, 1259.1521739959717, 1279.7493934631348, 1301.2442588806152, 1280.8051109313965, 1317.1720504760742, 1264.969825744629, 1287.5959873199463, 1270.172119140625, 1300.6203174591064, 1260.838270187378, 1308.7995052337646, 1270.6804275512695, 1295.3004837036133, 1280.2510261535645, 1311.8414878845215, 1269.81782913208, 1309.7734451293945, 1283.3983898162842, 1294.2407131195068, 1276.55029296875, 1311.3126754760742]

    awgComplex1 = Average(Complex1)
    awgComplex2 = Average(Complex2)
    awgComplex3 = Average(Complex3)
    print('(Request aware PipeSwitch) Average time for Complex1 is : ' + str(awgComplex1))
    print('(Request aware PipeSwitch) Average time for Complex2 is : ' + str(awgComplex2))
    print('(Request aware PipeSwitch) Average time for Complex3 is : ' + str(awgComplex3))

    Complex1_ps = [1657.7155590057373, 1140.580415725708, 1131.2313079833984, 1159.566879272461, 1148.1173038482666, 1136.6419792175293, 1165.7683849334717, 1138.6313438415527, 1132.659912109375, 1126.4011859893799, 1162.0209217071533, 1171.6892719268799, 1168.1549549102783, 1150.780439376831, 1134.4013214111328, 1129.3864250183105, 1125.8854866027832, 1139.6512985229492, 1130.145788192749, 1130.0218105316162, 1127.8455257415771, 1127.4657249450684, 1130.5313110351562, 1128.1955242156982, 1148.7720012664795, 1123.284101486206, 1131.8469047546387, 1162.4207496643066, 1139.939546585083, 1145.3752517700195, 1143.4168815612793, 1138.6168003082275, 1137.9480361938477, 1139.9922370910645, 1138.0388736724854, 1134.2072486877441, 1145.1542377471924, 1142.2388553619385, 1137.9806995391846, 1131.6735744476318, 1139.427661895752, 1139.281988143921, 1137.3424530029297, 1150.1133441925049, 1134.3293190002441, 1131.1287879943848, 1135.366678237915, 1145.9128856658936, 1131.8678855895996, 1123.3291625976562]
    Complex2_ps = [1293.947458267212, 768.5823440551758, 747.8418350219727, 773.8380432128906, 737.0197772979736, 754.7013759613037, 759.4923973083496, 753.5984516143799, 740.3726577758789, 760.826587677002, 759.6921920776367, 738.5890483856201, 738.8086318969727, 747.412919998169, 740.0264739990234, 742.8297996520996, 729.1479110717773, 760.7662677764893, 734.0915203094482, 730.7243347167969, 733.767032623291, 742.1243190765381, 739.213228225708, 741.229772567749, 744.1842555999756, 746.680498123169, 757.6465606689453, 743.8642978668213, 740.1297092437744, 751.3933181762695, 737.0185852050781, 734.1060638427734, 736.8013858795166, 731.696605682373, 732.38205909729, 728.2757759094238, 742.2747611999512, 737.8339767456055, 726.0942459106445, 727.6086807250977, 746.7505931854248, 746.5834617614746, 735.5329990386963, 748.7332820892334, 744.3273067474365, 763.986349105835, 743.8843250274658, 755.0160884857178, 742.1619892120361, 765.0034427642822]
    Complex3_ps = [1976.660966873169, 1553.4048080444336, 1528.4476280212402, 1444.1957473754883, 1422.1253395080566, 1463.9129638671875, 1428.8394451141357, 1442.1226978302002, 1471.8797206878662, 1425.1155853271484, 1425.954818725586, 1404.0913581848145, 1446.232557296753, 1426.6600608825684, 1462.8345966339111, 1446.5503692626953, 1451.9257545471191, 1435.5251789093018, 1417.5500869750977, 1421.222448348999, 1425.1558780670166, 1416.4230823516846, 1428.391456604004, 1406.557559967041, 1431.0662746429443, 1403.6955833435059, 1420.6407070159912, 1409.975290298462, 1472.3656177520752, 1417.9434776306152, 1449.70703125, 1446.92063331604, 1440.0720596313477, 1453.4974098205566, 1432.39164352417, 1406.137228012085, 1423.9299297332764, 1418.0176258087158, 1417.9191589355469, 1424.0736961364746, 1424.0045547485352, 1412.402629852295, 1438.7402534484863, 1441.5299892425537, 1450.5646228790283, 1428.955316543579, 1448.6002922058105, 1437.03293800354, 1445.2686309814453, 1420.6130504608154]

    awgComplex1_ps = Average(Complex1_ps)
    awgComplex2_ps = Average(Complex2_ps)
    awgComplex3_ps = Average(Complex3_ps)
    print('(PipeSwitch) Average time for Complex1 is : ' + str(awgComplex1_ps))
    print('(PipeSwitch) Average time for Complex2 is : ' + str(awgComplex2_ps))
    print('(PipeSwitch) Average time for Complex3 is : ' + str(awgComplex3_ps))


    #Resnet --->BertBase
    RN_t_BB_i = Average([110.08548736572266, 60.32133102416992, 58.96878242492676, 58.684349060058594, 59.64303016662598, 60.018301010131836, 62.8659725189209, 59.56530570983887, 61.437129974365234, 61.026573181152344, 60.236454010009766, 60.31918525695801, 61.40947341918945, 61.208486557006836, 61.23948097229004, 60.40453910827637, 61.50507926940918, 59.08489227294922, 60.13917922973633, 60.00185012817383, 60.45269966125488, 60.23383140563965, 64.02826309204102, 60.60600280761719, 59.15498733520508, 60.58669090270996, 60.00208854675293, 62.16025352478027, 60.31012535095215, 60.16683578491211, 62.09063529968262, 58.91680717468262, 61.8131160736084, 60.61506271362305, 65.80495834350586, 61.21540069580078, 61.86699867248535, 61.0201358795166, 59.15570259094238, 62.81089782714844, 61.069488525390625, 60.61887741088867, 61.536550521850586, 60.68134307861328, 60.452938079833984, 60.994863510131836, 59.394121170043945, 59.12351608276367, 61.60235404968262, 60.67943572998047])
    RN_t_I3_i = Average([133.88562202453613, 89.24651145935059, 84.46240425109863, 86.94005012512207, 84.07139778137207, 96.2834358215332, 80.9793472290039, 82.1390151977539, 86.06362342834473, 83.89759063720703, 84.37657356262207, 104.33125495910645, 77.65650749206543, 83.88304710388184, 79.13684844970703, 82.10277557373047, 77.84104347229004, 78.3689022064209, 76.25746726989746, 79.63347434997559, 79.6060562133789, 78.42063903808594, 78.5531997680664, 87.98646926879883, 79.04648780822754, 77.53944396972656, 81.2375545501709, 77.09813117980957, 79.0398120880127, 77.15797424316406, 78.57537269592285, 77.76093482971191, 78.74655723571777, 81.34150505065918, 81.33101463317871, 79.45585250854492, 79.62942123413086, 80.15966415405273, 80.41620254516602, 82.72385597229004, 76.47156715393066, 83.47916603088379, 78.1259536743164, 79.82730865478516, 79.36716079711914, 79.39362525939941, 78.18055152893066, 79.89025115966797, 86.09867095947266, 78.27162742614746])
    BB_t_I3_i = Average([99.7316837310791, 93.27292442321777, 96.23908996582031, 88.0734920501709, 86.75265312194824, 88.61541748046875, 80.12914657592773, 85.92772483825684, 85.36839485168457, 82.1681022644043, 85.03365516662598, 82.59177207946777, 86.3199234008789, 85.41131019592285, 92.9098129272461, 92.78440475463867, 83.8921070098877, 94.41089630126953, 74.07665252685547, 87.3863697052002, 83.54377746582031, 83.12821388244629, 88.90533447265625, 84.60474014282227, 78.40371131896973, 84.06639099121094, 96.71521186828613, 84.06710624694824, 84.89131927490234, 82.2763442993164, 81.74967765808105, 79.00452613830566, 87.81933784484863, 82.08131790161133, 77.10599899291992, 86.15255355834961, 77.08024978637695, 77.98314094543457, 80.40642738342285, 87.28146553039551, 80.56306838989258, 80.35087585449219, 79.30541038513184, 83.01711082458496, 78.48715782165527, 78.96614074707031, 74.95355606079102, 88.89150619506836, 79.9567699432373, 78.16457748413086])
    BB_t_RN_i = Average([361.4356517791748, 90.39878845214844, 97.5947380065918, 94.45571899414062, 98.24562072753906, 89.83278274536133, 94.46382522583008, 103.76238822937012, 89.75696563720703, 94.40422058105469, 95.02553939819336, 85.97397804260254, 95.68190574645996, 88.94515037536621, 86.14253997802734, 96.62604331970215, 91.8114185333252, 92.69928932189941, 88.33861351013184, 87.97812461853027, 85.8602523803711, 85.72173118591309, 86.08317375183105, 97.80287742614746, 91.13454818725586, 90.99125862121582, 93.77622604370117, 85.64233779907227, 85.97660064697266, 91.22991561889648, 92.26751327514648, 85.95418930053711, 96.15230560302734, 88.2101058959961, 93.75739097595215, 89.1721248626709, 95.45445442199707, 85.59608459472656, 85.07704734802246, 85.56127548217773, 86.3494873046875, 90.12508392333984, 94.89083290100098, 86.12298965454102, 87.5849723815918, 92.9408073425293, 87.55826950073242, 92.06247329711914, 85.08682250976562, 86.67564392089844])
    I3_t_BB_i = Average([60.38022041320801, 57.114362716674805, 59.10754203796387, 59.50665473937988, 58.05826187133789, 58.86507034301758, 57.743072509765625, 61.42616271972656, 58.473825454711914, 58.74228477478027, 58.014631271362305, 57.66582489013672, 58.576107025146484, 58.956146240234375, 64.57972526550293, 58.34555625915527, 59.55362319946289, 59.59653854370117, 59.92555618286133, 59.81278419494629, 59.86475944519043, 59.69071388244629, 58.32362174987793, 58.32839012145996, 59.18550491333008, 58.812618255615234, 59.366703033447266, 60.27865409851074, 57.41763114929199, 59.08012390136719, 59.69834327697754, 58.846235275268555, 58.159828186035156, 57.65414237976074, 58.917999267578125, 58.87341499328613, 59.447288513183594, 57.738542556762695, 59.26036834716797, 61.266183853149414, 59.80992317199707, 58.58302116394043, 60.97579002380371, 59.25774574279785, 60.81581115722656, 58.4568977355957, 58.90226364135742, 60.40024757385254, 61.16199493408203, 58.76755714416504])
    I3_t_RN_i = Average([98.33526611328125, 89.16449546813965, 80.23738861083984, 90.66629409790039, 85.00170707702637, 84.52630043029785, 82.84306526184082, 83.3439826965332, 82.7493667602539, 83.58263969421387, 85.19577980041504, 84.21778678894043, 87.48984336853027, 84.03682708740234, 84.46121215820312, 85.31427383422852, 82.31067657470703, 87.75734901428223, 87.5086784362793, 93.12701225280762, 88.81902694702148, 88.88626098632812, 85.19172668457031, 87.34774589538574, 86.90547943115234, 83.89520645141602, 84.13219451904297, 83.2669734954834, 85.97874641418457, 86.91000938415527, 85.69073677062988, 87.16392517089844, 85.99853515625, 82.9477310180664, 84.42044258117676, 86.0602855682373, 85.32094955444336, 86.26341819763184, 88.70339393615723, 85.66617965698242, 80.95812797546387, 86.34805679321289, 81.08091354370117, 84.13386344909668, 92.18764305114746, 87.04328536987305, 89.24221992492676, 84.04779434204102, 86.56477928161621, 84.08451080322266])
    print('Resnet152 ---> BertBase : ' + str(RN_t_BB_i))
    print('Resnet152 ---> Inception : '+ str(RN_t_I3_i))
    print('BertBase ---> Inception : '+ str(BB_t_I3_i))
    print('BertBase ---> ResNet152 : '+ str(BB_t_RN_i))
    print('Inception ---> BertBase : '+ str(I3_t_BB_i))
    print('Inception ---> ResNet152 : '+ str(I3_t_RN_i))

    RN_t_RN_i = 80.487001
    BB_t_BB_i = 62.015140
    I3_t_I3_i = 65.726674
    print('ResNet152 ---> ResNet152 : '+ str(RN_t_RN_i))
    print('Bert_base ---> Bert_Base : '+ str(BB_t_BB_i))
    print('Inception ---> Inception : '+ str(I3_t_I3_i))

    RN_i = 76.353168
    BB_i = 55.139515
    I3_i = 65.154070
    print('ResNet152 inference : '+ str(RN_i))
    print('Bert_base inference : '+ str(BB_i))
    print('Inception inference : '+ str(I3_i))

def Average(lst):
    return sum(lst) / len(lst)    
if __name__ == '__main__':
    main()
